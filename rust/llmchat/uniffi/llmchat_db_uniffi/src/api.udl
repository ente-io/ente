[Error]
interface DbError {
  Message(string message);
};

enum Sender {
  "SelfUser",
  "Other"
};

enum AttachmentKind {
  "Image",
  "Document"
};

dictionary AttachmentMeta {
  string id;
  AttachmentKind kind;
  i64 size;
  string name;
};

dictionary Session {
  string uuid;
  string title;
  i64 created_at_us;
  i64 updated_at_us;
  string? remote_id;
  boolean needs_sync;
  i64? deleted_at_us;
};

dictionary Message {
  string uuid;
  string session_uuid;
  string? parent_message_uuid;
  Sender sender;
  string text;
  sequence<AttachmentMeta> attachments;
  i64 created_at_us;
  i64? deleted_at_us;
};

namespace llmchat_db_uniffi {
  interface LlmChatDb {
    [Constructor, Throws=DbError]
    LlmChatDb(string main_db_path, string attachments_db_path, sequence<u8> key);

    [Throws=DbError]
    Session create_session(string title);

    [Throws=DbError]
    sequence<Session> list_sessions();

    [Throws=DbError]
    Session? get_session(string uuid);

    [Throws=DbError]
    void delete_session(string uuid);

    [Throws=DbError]
    Message insert_message(string session_uuid, Sender sender, string text, string? parent_message_uuid, sequence<AttachmentMeta> attachments);

    [Throws=DbError]
    sequence<Message> get_messages(string session_uuid);

    [Throws=DbError]
    void update_message_text(string uuid, string text);
  };
};
